{% extends 'core/partials/base.html' %} 

{% block content %}
{% csrf_token %}
    <button class="btn btn-secondary" id="saveBtn">Save</button>
    <div id="aliasTable"></div>

    <script>
        // Get CSRF token
        function getCSRFToken() {
            return document.querySelector('[name=csrfmiddlewaretoken]').value;
        }

        // Load data from Django view
        let data = {{ data|safe }};

        // Create Handsontable instance
        var container = document.getElementById('aliasTable');
        var hot = new Handsontable(container, {
            data: data,
            columns: [
                { data: 'id', type: 'numeric', readOnly: true },
                { data: 'name', type: 'text' },
                { data: 'wwpn', type: 'text' },
                { data: 'use', type: 'text' },
                { data: 'fabric', type: 'text' },
                { data: 'create', type: 'text' },
                { data: 'include_in_zoning', type: 'text' },
            ],
            colHeaders: ['ID', 'Name', 'WWPN', 'Use', 'Fabric', 'Create', 'Zone'],
            rowHeaders: true,
            minSpareRows: 1,  // Allow adding new rows
            licenseKey: 'non-commercial-and-evaluation' // Required for free version
        });

        // Save Button Click Event
        document.getElementById("saveBtn").addEventListener("click", function() {
            let updatedData = hot.getData();
            let formattedData = updatedData.map(row => ({
                id: row[0] || null,
                name: row[1] || '',
                wwpn: row[2] || ''
            }));

            fetch("/save_aliases/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken()
                },
                body: JSON.stringify(formattedData)
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => console.error("Error:", error));
        });
    </script>


{% endblock %}